<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blog — C. Morgan Davis</title>
  <meta name="description" content="Blog posts by C. Morgan Davis, Data Professional." />

  <!-- marked.js CDN (Markdown → HTML) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Site styles -->
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>

  <!-- =============================================
       STICKY NAV
       ============================================= -->
  <nav class="site-nav" aria-label="Site navigation">
    <div class="nav-inner">

      <!-- Brand: avatar + name + contact -->
      <a class="nav-brand" href="index.html" aria-label="C. Morgan Davis — home">
        <img
          class="nav-avatar"
          src="assets/avatar.jpg"
          alt="C. Morgan Davis"
          onerror="this.style.visibility='hidden'"
        />
        <span class="nav-brand-text">
          <span class="nav-name">C. Morgan Davis</span>
        </span>
      </a>

      <!-- Hamburger (mobile) -->
      <button
        class="nav-hamburger"
        id="nav-hamburger"
        aria-controls="nav-links"
        aria-expanded="false"
        aria-label="Toggle navigation menu"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Nav links + icons -->
      <ul class="nav-links" id="nav-links" role="list">
        <li class="nav-email-item"><a href="mailto:cmdavis25@proton.me">cmdavis25@proton.me</a></li>
        <li><a href="tel:4157295387" class="nav-phone">415-729-5387</a></li>
        <li><a href="projects.html">Projects</a></li>
        <li><a href="resume.html" class="nav-resume-btn">Resume</a></li>
        <li><a href="bio.html">Bio</a></li>
        <li><a href="blog.html">Blog</a></li>

        <!-- Social icons -->
        <li class="nav-icons-row">
          <!-- GitHub icon -->
          <a
            href="https://github.com/cmdavis25"
            class="nav-icon-link"
            target="_blank"
            rel="noopener"
            aria-label="GitHub profile"
          >
            <svg viewBox="0 0 16 16" aria-hidden="true">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38
                0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13
                -.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66
                .07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15
                -.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27
                .68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12
                .51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48
                0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
            </svg>
          </a>

          <!-- LinkedIn icon -->
          <a
            href="https://www.linkedin.com/in/c-morgan-davis/"
            class="nav-icon-link"
            target="_blank"
            rel="noopener"
            aria-label="LinkedIn profile"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037
                -1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046
                c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337
                7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782
                13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542
                C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729
                C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
        </li>
      </ul>

    </div>
  </nav>

  <!-- =============================================
       MAIN CONTENT
       ============================================= -->
  <main class="site-main">
    <div class="container">

      <section class="page-section" id="blog" aria-labelledby="heading-blog">
        <h2 class="section-heading" id="heading-blog">Blog</h2>
        <div id="posts-list">
          <p class="loading-msg">Loading posts…</p>
        </div>
      </section>

    </div>
  </main>

  <!-- Site JS (shared utilities + nav toggle) -->
  <script src="assets/main.js?v=2"></script>

  <script>
    (async () => {
      const listEl = document.getElementById('posts-list');
      const files = await loadIndex('posts.json');

      if (!files.length) {
        listEl.innerHTML = '<p class="loading-msg">No posts yet.</p>';
        return;
      }

      listEl.innerHTML = '';

      for (const filename of files) {
        const url = 'blog_posts/' + filename;
        try {
          const res = await fetch(url, { cache: 'no-cache' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const text = await res.text();
          const { data, content } = parseFrontMatter(text);

          // Format date
          const dateStr = data.date
            ? new Date(data.date + 'T00:00:00').toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
            : '';

          // Body content (rendered Markdown)
          const bodyHTML = marked.parse(content);

          const cardEl = document.createElement('article');
          cardEl.className = 'card';
          cardEl.dataset.accordion = 'manual';
          cardEl.id = filename;
          cardEl.innerHTML = `
            <div class="card-title">${data.title || filename}</div>
            <div class="card-meta">${dateStr}</div>
            ${data.summary ? `<div class="card-summary">${data.summary}</div>` : ''}
            <div class="post-card-actions">
              <button class="post-toggle" aria-expanded="false">Read more ▾</button>
            </div>
            <div class="accordion-body md-content">
              ${bodyHTML}
              <div class="post-card-actions post-card-actions--bottom">
                <button class="post-toggle">Collapse ▴</button>
              </div>
            </div>`;

          const toggleBtn = cardEl.querySelector('.post-toggle');
          const bottomBtn = cardEl.querySelectorAll('.post-toggle')[1];
          const body = cardEl.querySelector('.accordion-body');

          const collapse = () => {
            body.classList.remove('is-open');
            toggleBtn.setAttribute('aria-expanded', 'false');
            toggleBtn.textContent = 'Read more ▾';
          };

          toggleBtn.addEventListener('click', () => {
            const isOpen = body.classList.toggle('is-open');
            toggleBtn.setAttribute('aria-expanded', String(isOpen));
            toggleBtn.textContent = isOpen ? 'Collapse ▴' : 'Read more ▾';
          });

          bottomBtn.addEventListener('click', collapse);

          listEl.appendChild(cardEl);
        } catch (err) {
          const errEl = document.createElement('p');
          errEl.className = 'error-msg';
          errEl.textContent = `Could not load ${filename} (${err.message}).`;
          listEl.appendChild(errEl);
        }
      }

      // Auto-expand the card named in the URL hash (e.g. blog.html#blog_foo.md)
      if (location.hash) {
        const targetId = decodeURIComponent(location.hash.slice(1));
        const target = document.getElementById(targetId);
        if (target) {
          const toggleBtn = target.querySelector('.post-toggle');
          const body = target.querySelector('.accordion-body');
          if (toggleBtn && body) {
            body.classList.add('is-open');
            toggleBtn.setAttribute('aria-expanded', 'true');
            toggleBtn.textContent = 'Collapse ▴';
          }
          // Scroll after layout settles, offsetting for the sticky nav
          requestAnimationFrame(() => {
            const navHeight = document.querySelector('.site-nav')?.offsetHeight || 0;
            const top = target.getBoundingClientRect().top + window.scrollY - navHeight - 16;
            window.scrollTo({ top, behavior: 'smooth' });
          });
        }
      }
    })();
  </script>

</body>
</html>
